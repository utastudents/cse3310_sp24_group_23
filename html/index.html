<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Search Game Lobby</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <style>
        .change-username-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 260px;
            background-color: #f1f1f1;
            padding: 10px;
            box-sizing: border-box;
            border-radius: 10px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .change-username {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .change-username label {
            margin-right: 5px;
        }
        .change-username input {
            margin-right: 10px;
            text-align: center;
        }
        .change-username button {
            margin-top: 4px;
        }

        .chat-container {
            position: fixed;
            top: 160px;
            right: 20px;
            bottom: 20px;
            width: 260px;
            background-color: #f1f1f1;
            padding: 20px;
            box-sizing: border-box;
            border-radius: 10px;
            overflow-y: auto;
        }

        .chat-messages {
            margin-bottom: 10px;
        }

        .chat-input {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }

        .lobby-list {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="lobby-main">
        <div class="row">
            <div class="col-md-8">
                <div class="lobbyForm container text-center">
                    <h1>Wurdle</h1>
                    <h2>The Word Search Game</h2>
                    <p>Please enter your username:</p>
                    <form id="lobbyForm">
                        <div class="form-group">
                            <input type="text" class="form-control" id="username" name="username" placeholder="Username..." required style="width: 200px; margin: auto;">
                            <button type="submit" class="btn btn-primary mt-3">Start Game</button>
                        </div>
                    </form>
                </div>
                <div class="lobby-list container text-center ">
                    <h3>Games in Progress</h3>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Lobby Name</th>
                                <th>Status</th>
                                <th>Player Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- List of players in the lobby will be displayed here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="change-username-container">
                <div class="change-username">
                    <label for="new-username">Username/Nickname:</label>
                    <!-- Get username and make it the placeholder-->
                    <input type="text" class="form-control" id="new-username" placeholder="Username..." >
                    <!-- <button class="btn btn-primary" onclick="changeUsername()">Update</button> -->
                    <button class="btn btn-primary">Update</button>
                </div>
            </div>
            <!-- chat box -->
            <div class="chat-container">
                <h3>Chat</h3>
                <div class="chat-messages">
                    <!-- Chat messages will be displayed here -->
                </div>
                <div class = "chat-input">
                    <div class="input-group">
                        <input type="text" class="form-control" id="message" placeholder="Type a message..." required>
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="button" onclick="sendMessage()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- end of row -->
    </div> <!-- end of lobby-main -->



    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-w0Yur8YnYVVuoCjwMnz/e6qlR+lt6zEdN+I3r0pWYyz6L/GFqnsJvST5l8GkZpQG"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shC1n3EJm9q3/eplmoUqSz/8+0Gni4k+Ousn6"
        crossorigin="anonymous"></script>

    <script>
 
        var serverUrl = "ws://" + window.location.hostname +":"+ (parseInt(location.port) + 100);
            console.log(serverUrl);
        var webSocket = new WebSocket(serverUrl);

        webSocket.onopen = function (event) {
            console.log("WebSocket connection opened.");
        };

        webSocket.onerror = function (event) {
            console.error("WebSocket error: ", event);
        };

        var messages = {};


        
        webSocket.onmessage = function (event) {
            var message = JSON.parse(event.data);
            if ("messageBoard" in message) {
                /**
                 * messageBoard: [
                 * {"username": "Player 1", "message": "Hello, is anyone here?"},]
                 */

                // add last message to the chat box
                addMessage(message.messageBoard[message.messageBoard.length - 1].username, message.messageBoard[message.messageBoard.length - 1].message);

            }
        };

        const addMessage = (username, message) => {
            var chatMessages = document.querySelector(".chatMessages");
            var chatMessage = document.createElement("div");
            chatMessage.textContent = username + ": " + message;
            chatMessages.appendChild(chatMessage);
        }

   

        const sendMessage = async () => {
            // websocket request
            webSocket.send(JSON.stringify({
                "type": "message",
                "content": document.getElementById("message").value
            }));

            // clear the input field
            document.getElementById("message").value = "";
        }
        
        document.addEventListener("DOMContentLoaded", function () {
            // JavaScript to update the chat messages
            chatMessages.messages.forEach(function (chatMessage) {
                addMessage(chatMessage.username, chatMessage.message);
            });
        });
        

        document.addEventListener("DOMContentLoaded", function () {
            // JavaScript to update the list of players in the lobby
           var data = [
            {lobbyName: "Lobby 1", status: "In Progress", playerCount: 3, maxPlayers: 4},
           ]
           var tbody = document.querySelector(".lobbyList tbody");
            
            data.forEach(function (lobby) {
                var row = document.createElement("tr");
                var lobbyName = document.createElement("td");
                var status = document.createElement("td");
               
                var playerCount = document.createElement("td");

                lobbyName.textContent = lobby.lobbyName;
                status.textContent = lobby.status;
                
                playerCount.textContent = lobby.playerCount + "/" + lobby.maxPlayers;

                row.appendChild(lobbyName);
                row.appendChild(status);
                row.appendChild(playerCount);

                tbody.appendChild(row);
            });
        });

        // JavaScript to handle form submission
        document.getElementById("lobbyForm").addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent the default form submission
            var username = document.getElementById("username").value;
            if (username.trim() !== "") {
                // Redirect to the game page or perform any other action
                alert("Welcome, " + username + "! Starting the game...");
                // Replace 'game.html' with the actual URL of your game page
                window.location.href = "game.html";
            } else {
                alert("Please enter a username.");
            }
        });

        // JavaScript to handle message sent via enter key
        document.getElementById("message").addEventListener("keydown",function(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });

    </script>
</body>

</html>
